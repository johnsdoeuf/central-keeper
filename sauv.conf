# A chaque sauvegarde correspond une section
# Chaque section définie ses propres paramètres de sauvegarde au travers de clé
# Les noms de section et de clé ne sont pas sensibles à la casse   
#
  
#
# [DEFAULT] est une section spéciale qui permet de spécifier des paramètres pour les autres sections
# SI une clé n'est pas présent dans une section, celle de défault est utilisée à la place.


# liste des clés

# Toutes les durées sont exprimées en jour. 0,5 jour = 12 heures. le séparateur décimal est le point.
# Principes:
# Le programme dispose de 3 niveaux de sauvegarde, par exemple le jour la semaine et le mois. 
# Dans ce cas, les paramètre de périodes sont les suivants:
#PERIODE1=1
#PERIODE2=7  
#PERIODE2=30
# Il est possible de n'utiliser que une ou deux périodes ou même aucune. 
# Dans ce dernier cas, la sauvegarde se lance chaque fois que le programme est lancé, c'est l'équivalent de PERIODE1=0 

# Le paramètre "conservation" détermine combien de jour seront conservés. 
# Les paramètres conservations sont aussi exprimés en jours.
# CONSERVATION1 détermine le moment du passage au niveau 2
# CONSERVATION2 détermine le moment du passage au niveau 3
# Pour Conserver  3 jours de niveau 1 et deux semaines de niveau 2, Il faut écrire:
#CONSERVATION1=3
#CONSERVATION2=14
# Le paramètre de conservation détermine aussi la durée générale de conservation avant destruction.
# Le dernier paramètre CONSERVATION done la durée minimum de sauvegarde garantie. 
#CONSERVATION3=60
# Ce n'est pas forcément CONSERVATION3. par exemple les paramètres #PERIODE1=2 et #CONSERVATION1=30
# réalise des sauvegardes tous les deux jours et les conservent 1 mois soit 15 sauvegardes
# 
# La sauvegarde est asynchrone. le programme peut être lancé assez fréquement et les paramètres permettent de définir si une sauvegarde est nécessaire 
# En revanche, il est possible pour des raisons d'extinction des postes à sauvegarder que
# certaines sauvegardes ne soient pas réalisées. Ce n'est pas grave mais le nombre de sauvegarde est diminué. 
# c'est la durée qui prime et pas le nombre de sauvegarde  
# si la durée minimum de conservation est déterminée par ce paramètre, la durée maximum est définie par QUOTA
# QUOTA est la quantité d'espace disque allouée à une sauvegarde particulière. 
# Les données seront stockées jusqu'à 95% de QUOTA indiqué en Go (Gigaoctet=10⁹ octets), au-delà, elles sont supprimées
# Si La durée de conservation et le QUOTA sont imcompatibles, Une erreur est envoyé.
# Pensez à configurer une alerte mail dans log.conf
#QUOTA=60   #espace réservée 60 Go
#
# Il est possible de spécifier des commande à lancer si le disque n'est pas disponible 
# Le disque est monté seulement si une sauvegarde est nécessaire.
# De la même manière un paramètre défini la commande de démontage en fin de sauvegarde 
#MONTE_DESTINATION=mount -t ext4 /dev/sda1 /media/sauv3T
#DEMONTE_DESTINATION=umount /dev/sda1
#MONTE_SOURCE=mount
#DEMONTE_SOURCE=umount


# Les source et destination définissent s'écrivent sous une des formes suivantes:
#   -Répertoire linux: /home/johannes/
#   -Répertoire windows: C:/utilisateur/
#   -Serveur rsync: 192.168.1.29::share_rsync/répertoire/
#   -Liaison SSH:non implémenté
# Attention le / à la fin de la source change le comportement. Avec, le contenu du répertoire est copié 
# Sans, le denier répertoire de la source est copié avec son contenu. Il est possible de spécifier plusieurs source séparée par des ";"
# C'est utile pour les clé_usb ou disque amovible. La première source valide est utilisée.
#SOURCE=/home;/media
#DESTINATION=/sauvegarde

# La copie des fichiers est réalisée par Rsync. chaque fichier n'est copier qu'une fois sur le disque et des liens "durs" 
# Simule la présence des fichier dans toutes les sauvegardes.
# En situation normale, la comparaison des fichiers se fait sur la date et la taille.
# mais périodiquement, il est possible de forcer la détection par calcul du md5 de la source et de la destination
# PERIODEMD5=0 spécifie que la vérification se fait à chaque fois
#PERIODEMD5=15



# PARAMETRE=spécifie les paramètres à passer à rsync
# Le paramètres par defaut sont :-rv --delete  ne préserve pas les propriétaires ni les devices mais ne nécessite pas de permission
# ce qui a pour effet de bloquer la création des liens durs (les fichiers ne sont pas identiques)
# sudo rsync -av --delete, ils nécessitent d'être super utilisateur, mais permet l'utilisation de --link-dest
# Principales option de rsync:http://www.delafond.org/traducmanfr/man/man1/rsync.1.html

# Les sauvegardes sont envoyés dans un répertoire nommé par exemple:2017-01-29 09-30_1_2756
# Le répertoire correspond à ANNEE-MOIS-JOUR HEURE-MINUTE_NIVEAU_MD5.

# BILAN permet de définir le chemin vers un fichier de de bilan.
# Il enregistre pour chaque sauvegarde réalisée :
# date      Heure       Sauvegarde concernée        Volume échangé  Volume Incrément	   Débit     Volume sauvegarde
#BILAN=/root/sauvegarde/bilan.log


# Paramètres par défaut
# ---------------------------------------------------------------------------------------------
[DEFAULT]
PERIODE1=1
PERIODE2=7
CONSERVATION1=10
CONSERVATION2=60

BILAN=/root/sauvegarde/bilan.log

PARAMETRE=sudo rsync -av --delete --size-only

MONTE_DESTINATION=mount -t ext4 /dev/sda1 /media/sauv3T
DEMONTE_DESTINATION=umount /dev/sda1

PERIODEMD5=15

# sauvegarde du home du poste internet
# ---------------------------------------------------------------------------------------------
[internet_home]

SOURCE=192.168.1.29::internet_home/isabelle
DEST=/media/sauv3T/internet_home
FILTRE=internet_home_filter.conf

QUOTA=365


# sauvegarde de jeux linux home
# ---------------------------------------------------------------------------------------------
[jeux_home]

SOURCE=192.168.1.28::jeux_home/
DEST=/media/sauv3T/jeux_home
FILTRE=jeux_home_filter.conf

QUOTA=50

PERIODE1=0
PERIODE2=1
PERIODE3=7
CONSERVATION1=2
CONSERVATION2=15
CONSERVATION3=300


# sauvegarde du serveur sauf Films, podcast et Jeux
# ---------------------------------------------------------------------------------------------
[omv_partage]

SOURCE=/media/e01e14b8-9252-4266-9825-48029162db87/partage/
DEST=/media/sauv3T/omv_partage
FILTRE=omv_partage_filter.conf

QUOTA=300


CONSERVATION1=7
CONSERVATION2=180

# sauvegarde de Films, podcast et Jeux du serveur
# ---------------------------------------------------------------------------------------------
[omv_partage2]

SOURCE=/media/e01e14b8-9252-4266-9825-48029162db87/partage/
DEST=/media/sauv3T/omv_partage2
FILTRE=omv_partage2_filter.conf

QUOTA=700

PERIODE1=7
CONSERVATION1=30

# --------------------------------------------------------------------------------------------
# sauvegarde de jeux données
[jeux_donnees]


PERIODE1=0
PERIODE2=1
PERIODE3=7
CONSERVATION1=2
CONSERVATION2=15
CONSERVATION3=300

SOURCE=192.168.1.155::DONNEES
DEST=/media/sauv3T/jeux_donnees


QUOTA=400
#MONTE_SOURCE=mount -t ntfs-3g /dev/sda7 /media/donnees -o defaults
#DEMONTE_SOURCE=umount /media/donnees
FILTRE=jeux_donnees_filter.conf

# --------------------------------------------------------------------------------------------
# sauvegarde de jeux extension
[jeux_extension]


PERIODE1=1
SOURCE=192.168.1.155::EXTENSION
DEST=/media/sauv3T/jeux_extension


QUOTA=400
#MONTE_SOURCE=mount -t ntfs-3g /dev/sdb5 /media/extension -o defaults
#DEMONTE_SOURCE=umount /media/extension
FILTRE=jeux_extension_filter.conf


[cle_jo]
PERIODE1=1
SOURCE=192.168.1.28::cle_jo;192.168.1.155::CLE_JO
DEST=/media/sauv3T/cle_jo



QUOTA=25

CONSERVATION3=200

FILTRE=cle_anaelle_filter.conf

[cle_anaelle]
PERIODE1=1
SOURCE=192.168.1.29::cle_anaelle;192.168.1.30::cle_anaelle
DEST=/media/sauv3T/cle_anaelle

QUOTA=5

CONSERVATION3=200

FILTRE=cle_jo_filter.conf

# sauvegarde du home du portable d'isabelle
# ---------------------------------------------------------------------------------------------
[port_home]

SOURCE=192.168.1.31::port_home/isabelle
DEST=/media/sauv3T/port_home
FILTRE=internet_home_filter.conf

QUOTA=60

# sauvegarde du home du poste des enfants
# ---------------------------------------------------------------------------------------------
[etage_home]

SOURCE=192.168.1.30::etage_home/enfants
DEST=/media/sauv3T/etage_home
FILTRE=internet_home_filter.conf

QUOTA=60

# --------------------------------------------------------------------------------------------
# sauvegarde de la freebox
[freebox]


PERIODE1=1
PERIODE2=1

CONSERVATION1=4
CONSERVATION2=4


SOURCE=/media/freebox
DEST=/media/sauv3T/freebox


QUOTA=300
MONTE_SOURCE=mount -t cifs -o rw,users,noauto,iocharset=utf8,uid=1000,sec=none,file_mode=0777,dir_mode=0777 "//192.168.1.254/Disque dur" /media/freebox

DEMONTE_SOURCE=umount /media/freebox 
#FILTRE=jeux_donnees_filter.conf



